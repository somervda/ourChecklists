<app-subheading
  [prompt]="
    'Checklist Item Design - ' +
    (crudAction == Crud.Create
      ? 'Create'
      : crudAction == Crud.Update
      ? 'Update'
      : 'Delete')
  "
  [iconActions]="[
    {
      icon: 'arrow_back',
      toolTip: 'Return to Checklist Design',
      routerLink: '/checklistdesign/' + cid
    }
  ]"
  matIcon="check_box"
></app-subheading>

<div class="page-container">
  <form class="standard-form" [formGroup]="checklistitemForm">
    <fieldset [disabled]="crudAction == Crud.Delete">
      <mat-form-field class="full-width">
        <input
          matInput
          formControlName="name"
          (change)="onFieldUpdate('name')"
          placeholder="Name"
          required
        />
        <mat-error
          *ngIf="checklistitemForm.controls['name'].hasError('required')"
        >
          Name is required.
        </mat-error>
        <mat-error
          *ngIf="checklistitemForm.controls['name'].hasError('minlength')"
        >
          Name must be at least 10 characters long.
        </mat-error>
        <mat-error
          *ngIf="checklistitemForm.controls['name'].hasError('maxlength')"
        >
          Name must be no more than 160 characters long.
        </mat-error>
      </mat-form-field>

      <mat-form-field class="full-width">
        <textarea
          matInput
          formControlName="description"
          (change)="onFieldUpdate('description')"
          matAutosizeMinRows="3"
          matAutosizeMaxRows="10"
          matTextareaAutosize
          placeholder="Description"
          required
        ></textarea>
        <mat-error
          *ngIf="checklistitemForm.controls['description'].hasError('required')"
        >
          Description is required.
        </mat-error>
        <mat-error
          *ngIf="
            checklistitemForm.controls['description'].hasError('minlength')
          "
        >
          Description must be at least 10 characters long.
        </mat-error>
        <mat-error
          *ngIf="
            checklistitemForm.controls['description'].hasError('maxlength')
          "
        >
          Description must be no more than 500 characters long.
        </mat-error>
      </mat-form-field>

      <mat-form-field class="half-width">
        <input
          matInput
          formControlName="sequence"
          (change)="onFieldUpdate('sequence', 'number')"
          placeholder="Sequence Number"
          required
        />
        <mat-error
          *ngIf="checklistitemForm.controls['sequence'].hasError('required')"
        >
          Sequence is required.
        </mat-error>
      </mat-form-field>
    </fieldset>

    <br />

    <!-- <mat-expansion-panel hideToggle [disabled]="crudAction == Crud.Delete">
      <mat-expansion-panel-header>
        <mat-panel-title>
          Activity Tags:
          <ng-container
            *ngIf="
              checklistitem.activities && checklistitem.activities.length > 0;
              else no_activities
            "
          >
            <span
              *ngFor="let activity of checklistitem.activities; let i = index"
            >
              <span *ngIf="i > 0">,</span>
              <span style="margin-left: 5px;">{{
                (activity | doc | async)?.name
              }}</span>
            </span>
          </ng-container>
          <ng-template #no_activites>
            None
          </ng-template>
        </mat-panel-title>
        <mat-panel-description>
          <mat-icon style="margin-left: auto;">edit</mat-icon>
        </mat-panel-description>
      </mat-expansion-panel-header> -->

    <!-- <ng-template matExpansionPanelContent> -->
    <app-activitylistedit
      [activities]="checklistitem.activities"
      [category]="(checklist$ | async).category | doc | async"
      (change)="onActivitiesChange($event)"
    >
    </app-activitylistedit>
    <!-- </ng-template>
    </mat-expansion-panel> -->
    <br />
    <!-- <mat-expansion-panel hideToggle [disabled]="crudAction == Crud.Delete">
      <mat-expansion-panel-header>
        <mat-panel-title>
          Resources: {{ flatDocRefArray(checklistitem.resources) }}
        </mat-panel-title>
        <mat-panel-description>
          <mat-icon style="margin-left: auto;">edit</mat-icon>
        </mat-panel-description>
      </mat-expansion-panel-header>
      <ng-template matExpansionPanelContent> -->
    <app-resourcelistedit
      [resources]="checklistitem.resources"
      (change)="onResourcesChange($event)"
    ></app-resourcelistedit>
    <!-- </ng-template>
    </mat-expansion-panel> -->
    <br />
    <mat-card>
      <h6>Checklist Result Options</h6>
      <mat-radio-group
        [(ngModel)]="checklistitem.resultType"
        [ngModelOptions]="{ standalone: true }"
        (change)="updateResultType()"
        [disabled]="crudAction == Crud.Delete"
      >
        <mat-radio-button [value]="ChecklistitemResultType.checkbox">
          Checkbox
        </mat-radio-button>
        <mat-radio-button [value]="ChecklistitemResultType.rating">
          Rating
        </mat-radio-button>
      </mat-radio-group>
      <div>
        <mat-checkbox
          class="full-width"
          (change)="updateAllowNA()"
          [(ngModel)]="checklistitem.allowNA"
          [ngModelOptions]="{ standalone: true }"
          [disabled]="crudAction == Crud.Delete"
          >Allow users to enter NA ?</mat-checkbox
        >
      </div>
      <div>
        <mat-checkbox
          class="full-width"
          (change)="updateRequireEvidence()"
          [(ngModel)]="checklistitem.requireEvidence"
          [ngModelOptions]="{ standalone: true }"
          [disabled]="crudAction == Crud.Delete"
          >User must provide evidence?</mat-checkbox
        >
      </div>
    </mat-card>

    <br />
    <button
      mat-raised-button
      color="primary"
      *ngIf="crudAction == Crud.Create"
      [disabled]="!checklistitemForm.valid"
      (click)="onCreate()"
      id="btnCreate"
    >
      <mat-icon>add</mat-icon>
      Create
    </button>
    <button
      mat-raised-button
      color="primary"
      *ngIf="crudAction == Crud.Delete"
      (click)="onDelete()"
      id="btnDelete"
    >
      <mat-icon>clear</mat-icon>
      Delete
    </button>
  </form>
</div>
